---
title: rollup
date: 2018-07-25 09:00:40
tags:
  - rollup
categories:
  - code
---

## æ‰“åŒ…jsçš„å¦ä¸€ä¸ªé€‰æ‹©
> Rollup æ˜¯ä¸€ä¸ª JavaScript æ¨¡å—æ‰“åŒ…å™¨

ä¹‹å‰å¼€å‘éƒ½æ˜¯åŸºäºwebpackï¼Œæ‰“åŒ…ä»£ç å½“ç„¶ç”¨webpackä¹Ÿå¯ä»¥ï¼Œä½†å¦‚æœæƒ³æ›´å¿«æ·çš„æ‰“åŒ…ï¼Œrollupä¹Ÿæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©
[rollup-demo](https://github.com/babytutu/rollup-demo)

<!--more-->

## ä¸€äº›æœ‰ç”¨çš„æ’ä»¶

### å¤„ç†å¤–éƒ¨æ¨¡å—
[rollup-plugin-node-resolve](https://github.com/rollup/rollup-plugin-node-resolve)

### è½¬è¯‘commonjsæ¨¡å—åˆ°ES6
[rollup-plugin-commonjs](https://github.com/rollup/rollup-plugin-commonjs)

### å¼•å…¥Babel
[rollup-plugin-babel](https://github.com/rollup/rollup-plugin-babel)

> options

|name|desc|type|default|
|---|---|---|---|
|babelrc|æ˜¯å¦å¯ç”¨é»˜è®¤çš„é…ç½®|Boolean|true|

[babel-preset-env](https://github.com/babel/babel/tree/master/packages/babel-preset-env)
[babel-plugin-external-helpers](https://github.com/babel/babel/tree/master/packages/babel-plugin-external-helpers)



### å¼•å…¥eslint
[rollup-plugin-eslint](https://github.com/TrySound/rollup-plugin-eslint)
[eslint](https://github.com/eslint/eslint)
[babel-eslint](https://github.com/babel/babel-eslint)

### å‹ç¼©/æ··æ·†ä»£ç 
[rollup-plugin-babel-minify](https://github.com/Comandeer/rollup-plugin-babel-minify)

> options

|name|desc|type|default|
|---|---|---|---|
|comments|æ˜¯å¦æŠŠæ³¨é‡Šæ‰“åŒ…|Boolean|true|
|sourceMap|æ˜¯å¦æŠŠsourceMapæ‰“åŒ…|Boolean|true|


## ä¸€ä¸ªç®€å•çš„ğŸŒ°

### å®‰è£…ä»¥ä¸Šæåˆ°çš„ä¾èµ–åŒ…

```bash
npm i -D rollup rollup-plugin-node-resolve rollup-plugin-commonjs rollup-plugin-babel babel-preset-env babel-plugin-external-helpers rollup-plugin-eslint eslint babel-eslint rollup-plugin-babel-minify
```

> ä¸€äº›é…ç½®æ–‡ä»¶

.babelrc

```json
{
  "presets": [
    [
      "env",
      {
        "modules": false
      }
    ]
  ],
  "plugins": [
    "external-helpers"
  ]
}
```

.eslintrc
```json
{
  "root": true,
  "env": {
    "browser": true,
    "node": true,
    "es6": true
  },
  "parserOptions": {
    "parser": "babel-eslint",
    "ecmaVersion": 6,
    "sourceType": "module"
  },
  "extends": [
    "eslint:recommended"
  ],
  "rules": {
    "no-console": [0]
  }
}
```


### rollupé…ç½®

> è™½ç„¶å‘½ä»¤è¡Œå¯ä»¥ç›´æ¥å‹ç¼©æ–‡ä»¶ï¼Œä½†ç”¨äº†æ’ä»¶ï¼Œéœ€è¦æœ‰ä¸ªé…ç½®æ–‡ä»¶ï¼Œé»˜è®¤å°±æ˜¯rollup.config.js

rollup.config.js

```js
import resolve from 'rollup-plugin-node-resolve'
import commonjs from 'rollup-plugin-commonjs'
import babel from 'rollup-plugin-babel'
import minify from 'rollup-plugin-babel-minify'
import { eslint } from 'rollup-plugin-eslint'

export default {
  input: 'src/main.js',
  output: [
    {
      file: 'dist/bundle.js',
      format: 'es'
    },
    {
      file: 'dist/bundle.umd.js',
      format: 'umd',
      name: 'answer'
    },
  ],
  plugins: [
    minify(),
    resolve(),
    commonjs(),
    babel(),
    eslint(),
  ]
}
```

### ç¤ºä¾‹
> éœ€è¦å¼•å…¥ä¸€ä¸ªâ€˜the-answerâ€™ç”¨æ¥æµ‹è¯•èƒ½å¦æ­£ç¡®åŠ è½½å¤–éƒ¨çš„åŒ…

```bash
npm i -D the-answer
```

src/main.js

```js
import answer from 'the-answer'

export default () => {
  console.log(`the answer is ${answer}`)
}
```

> å¢åŠ 1ä¸ªæ‰“åŒ…çš„å‘½ä»¤

package.json

```json
  "scripts": {
    "build": "rollup -c"
  },
```

> è¿è¡Œè„šæœ¬æŸ¥çœ‹ç»“æœ

```bash
npm run build
```

- ä¼šåœ¨distç›®å½•ç”Ÿæˆ2ä¸ªæ–‡ä»¶

## rollupå’Œgulpåœ¨ä¸€èµ·

```bash
npm i -D gulp
```

gulpfile.js
```js
const gulp = require('gulp')
const rollup = require('rollup')
const babel = require('rollup-plugin-babel')
const commonjs = require('rollup-plugin-commonjs')
const resolve = require('rollup-plugin-node-resolve')
const minify = require('rollup-plugin-babel-minify')
const {eslint} = require('rollup-plugin-eslint')

gulp.task('default', async () => {
  const bundle = await rollup.rollup({
    input: 'src/main.js',
    plugins: [
      minify(),
      resolve(),
      commonjs(),
      babel(),
      eslint(),
    ]
  })

  await bundle.write({
    file: 'dist/bundle.umd.gulp.js',
    format: 'umd',
    name: 'answer'
  })

  await bundle.write({
    file: 'dist/bundle.gulp.js',
    format: 'es',
  })
})

```

package.json
```json
  "scripts": {
    "gulp": "gulp"
  },
```

```bash
npm run gulp
```

- distæ–‡ä»¶å¤¹ä¸‹ä¼šç”Ÿæˆå¸¦gulpçš„2ä¸ªæ–‡ä»¶ï¼Œå’Œä¹‹å‰ç”Ÿæˆçš„æ–‡ä»¶å†…å®¹ç›¸åŒ


## rollupå’Œvueçš„æ•…äº‹

å®˜æ–¹å·²ç»å‡ºäº†æ•´åˆç‰ˆæœ¬æ’ä»¶[rollup-plugin-vue](https://github.com/vuejs/rollup-plugin-vue)